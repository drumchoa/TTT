import tkinter as tk
from tkinter import messagebox
from tkinter import font

class KidsKioskApp:
    def __init__(self, root):
        self.root = root
        self.root.title("ê¿ˆê¾¸ëŠ” ë„ì„œê´€ í‚¤ì˜¤ìŠ¤í¬ ğŸˆ")
        self.root.geometry("600x700")
        
        # --- ë””ìì¸ í…Œë§ˆ ì„¤ì • (íŒŒìŠ¤í…”í†¤) ---
        self.colors = {
            "bg": "#FFF9C4",        # ì—°í•œ ë…¸ë‘ (ë°°ê²½)
            "header": "#FFCC80",    # ì—°í•œ ì£¼í™© (í—¤ë”)
            "btn_primary": "#81D4FA", # í•˜ëŠ˜ìƒ‰ (ì£¼ìš” ë²„íŠ¼)
            "btn_action": "#FFAB91",  # ì‚´êµ¬ìƒ‰ (ë™ì‘ ë²„íŠ¼)
            "card_bg": "#FFFFFF",     # í°ìƒ‰ (ì±… ì¹´ë“œ ë°°ê²½)
            "text": "#5D4037"         # ì§„í•œ ê°ˆìƒ‰ (ê¸€ì)
        }
        
        self.root.configure(bg=self.colors["bg"])
        
        # --- í°íŠ¸ ì„¤ì • (ì‹œìŠ¤í…œì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ) ---
        self.title_font = font.Font(family="ë§‘ì€ ê³ ë”•", size=24, weight="bold")
        self.btn_font = font.Font(family="ë§‘ì€ ê³ ë”•", size=14, weight="bold")
        self.text_font = font.Font(family="ë§‘ì€ ê³ ë”•", size=12)
        self.emoji_font = font.Font(size=40) # ì´ëª¨ì§€ìš© í° í°íŠ¸

        # --- ë„ì„œ ë°ì´í„° (ê°€ìƒì˜ ë°ì´í„°) ---
        self.books = [
            {"id": 1, "title": "ê³µë£¡ì˜ ë¹„ë°€", "author": "ê¹€ê³µë£¡", "icon": "ğŸ¦–", "status": True},
            {"id": 2, "title": "ìš°ì£¼ ì—¬í–‰", "author": "ì´ìš°ì£¼", "icon": "ğŸš€", "status": True},
            {"id": 3, "title": "ë§›ìˆëŠ” ìš”ë¦¬", "author": "ë°•ì‰í”„", "icon": "ğŸ³", "status": False}, # ëŒ€ì¶œì¤‘
            {"id": 4, "title": "ìˆ²ì† ì¹œêµ¬ë“¤", "author": "ìµœí† ë¼", "icon": "ğŸ°", "status": True},
            {"id": 5, "title": "ì½”ë”© ì™•", "author": "íŒŒì´ì¬", "icon": "ğŸ’»", "status": True},
            {"id": 6, "title": "ì¶•êµ¬ì˜ ì‹ ", "author": "ì†í¥ë¯¼", "icon": "âš½", "status": True},
        ]

        # --- UI êµ¬ì„± ---
        self.create_header()
        self.create_search_bar()
        self.create_book_list_frame()
        self.refresh_book_list()

    def create_header(self):
        """ìƒë‹¨ í—¤ë” ì˜ì—­"""
        header_frame = tk.Frame(self.root, bg=self.colors["header"], height=80)
        header_frame.pack(fill="x")
        
        title_label = tk.Label(
            header_frame, 
            text="ğŸ“š ê¿ˆê¾¸ëŠ” ì–´ë¦°ì´ ë„ì„œê´€", 
            bg=self.colors["header"], 
            fg="white",
            font=self.title_font
        )
        title_label.pack(pady=20)

    def create_search_bar(self):
        """ê²€ìƒ‰ì°½ ì˜ì—­"""
        search_frame = tk.Frame(self.root, bg=self.colors["bg"], pady=20)
        search_frame.pack(fill="x")

        self.search_entry = tk.Entry(
            search_frame, 
            font=self.text_font, 
            width=20,
            bd=0,
            relief="flat",
            highlightthickness=2,
            highlightbackground=self.colors["btn_primary"]
        )
        self.search_entry.pack(side="left", padx=(50, 10), ipady=5)

        search_btn = tk.Button(
            search_frame,
            text="ê²€ìƒ‰ ğŸ”",
            bg=self.colors["btn_primary"],
            fg="white",
            font=self.btn_font,
            relief="flat",
            command=self.search_books,
            activebackground=self.colors["header"]
        )
        search_btn.pack(side="left", padx=5)

        reset_btn = tk.Button(
            search_frame,
            text="ì „ì²´ë³´ê¸°",
            bg=self.colors["btn_action"],
            fg="white",
            font=self.btn_font,
            relief="flat",
            command=lambda: self.refresh_book_list(),
            activebackground=self.colors["header"]
        )
        reset_btn.pack(side="left", padx=5)

    def create_book_list_frame(self):
        """ë„ì„œ ëª©ë¡ì´ í‘œì‹œë  ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ì˜ì—­"""
        container = tk.Frame(self.root, bg=self.colors["bg"])
        container.pack(fill="both", expand=True, padx=20, pady=10)

        # ìº”ë²„ìŠ¤ì™€ ìŠ¤í¬ë¡¤ë°” ì„¤ì • (ìŠ¤í¬ë¡¤ ê¸°ëŠ¥ êµ¬í˜„)
        self.canvas = tk.Canvas(container, bg=self.colors["bg"], highlightthickness=0)
        scrollbar = tk.Scrollbar(container, orient="vertical", command=self.canvas.yview)
        self.scrollable_frame = tk.Frame(self.canvas, bg=self.colors["bg"])

        self.scrollable_frame.bind(
            "<Configure>",
            lambda e: self.canvas.configure(scrollregion=self.canvas.bbox("all"))
        )

        self.canvas.create_window((0, 0), window=self.scrollable_frame, anchor="nw")
        self.canvas.configure(yscrollcommand=scrollbar.set)

        self.canvas.pack(side="left", fill="both", expand=True)
        scrollbar.pack(side="right", fill="y")

    def refresh_book_list(self, books_to_show=None):
        """ë„ì„œ ëª©ë¡ì„ í™”ë©´ì— ê·¸ë¦¬ëŠ” í•¨ìˆ˜"""
        # ê¸°ì¡´ ëª©ë¡ ì§€ìš°ê¸°
        for widget in self.scrollable_frame.winfo_children():
            widget.destroy()

        target_books = books_to_show if books_to_show is not None else self.books

        if not target_books:
            lbl = tk.Label(self.scrollable_frame, text="ì°¾ëŠ” ì±…ì´ ì—†ì–´ìš” ğŸ˜¢", bg=self.colors["bg"], font=self.text_font)
            lbl.pack(pady=20)
            return

        # 2ì—´ ê·¸ë¦¬ë“œë¡œ ë°°ì¹˜
        row = 0
        col = 0
        for book in target_books:
            self.create_book_card(book, row, col)
            col += 1
            if col > 1: # í•œ ì¤„ì— 2ê°œì”©
                col = 0
                row += 1

    def create_book_card(self, book, row, col):
        """ê°œë³„ ì±… ì¹´ë“œ ë””ìì¸"""
        card = tk.Frame(
            self.scrollable_frame, 
            bg=self.colors["card_bg"], 
            bd=2, 
            relief="ridge",
            width=250,
            height=150
        )
        # gridë¥¼ ì‚¬ìš©í•  ë•Œ í”„ë ˆì„ í¬ê¸° ê³ ì •ì„ ìœ„í•´ pack_propagate ë”
        card.pack_propagate(False) 
        card.grid(row=row, column=col, padx=10, pady=10)

        # ì±… ì•„ì´ì½˜
        tk.Label(
            card, text=book["icon"], bg="white", font=self.emoji_font
        ).pack(pady=(10, 0))

        # ì±… ì œëª©
        tk.Label(
            card, text=book["title"], bg="white", fg=self.colors["text"], font=("ë§‘ì€ ê³ ë”•", 12, "bold")
        ).pack()

        # ëŒ€ì¶œ ìƒíƒœ ë° ë²„íŠ¼
        status_text = "ëŒ€ì¶œ ê°€ëŠ¥" if book["status"] else "ëŒ€ì¶œ ì¤‘..."
        status_color = "#4CAF50" if book["status"] else "#FF5252" # ì´ˆë¡ / ë¹¨ê°•

        btn = tk.Button(
            card,
            text=status_text,
            bg=status_color,
            fg="white",
            font=("ë§‘ì€ ê³ ë”•", 10, "bold"),
            relief="flat",
            command=lambda b=book: self.open_book_popup(b)
        )
        btn.pack(side="bottom", fill="x", pady=5, padx=5)

    def search_books(self):
        """ì±… ê²€ìƒ‰ ë¡œì§"""
        keyword = self.search_entry.get().strip()
        if not keyword:
            self.refresh_book_list()
            return

        results = [b for b in self.books if keyword in b["title"] or keyword in b["author"]]
        self.refresh_book_list(results)

    def open_book_popup(self, book):
        """ì±… ìƒì„¸ ì •ë³´ ë° ëŒ€ì¶œ/ë°˜ë‚© íŒì—…"""
        popup = tk.Toplevel(self.root)
        popup.title(book["title"])
        popup.geometry("300x350")
        popup.configure(bg=self.colors["bg"])

        # ì•„ì´ì½˜
        tk.Label(popup, text=book["icon"], bg=self.colors["bg"], font=("Apple Color Emoji", 60)).pack(pady=20)
        
        # ì œëª© & ì‘ê°€
        tk.Label(popup, text=book["title"], bg=self.colors["bg"], font=("ë§‘ì€ ê³ ë”•", 16, "bold")).pack()
        tk.Label(popup, text=f"ì‘ê°€: {book['author']}", bg=self.colors["bg"], font=self.text_font).pack(pady=5)

        # ìƒíƒœ ë©”ì‹œì§€
        status_msg = "ì´ ì±…ì„ ë¹Œë¦´ê¹Œìš”?" if book["status"] else "ì±…ì„ ë°˜ë‚©í• ê¹Œìš”?"
        tk.Label(popup, text=status_msg, bg=self.colors["bg"], fg="#FF7043", font=self.text_font).pack(pady=20)

        # ë™ì‘ ë²„íŠ¼
        action_text = "ëŒ€ì¶œí•˜ê¸° ğŸ“–" if book["status"] else "ë°˜ë‚©í•˜ê¸° â†©ï¸"
        action_btn = tk.Button(
            popup,
            text=action_text,
            bg=self.colors["btn_primary"],
            fg="white",
            font=self.btn_font,
            width=15,
            height=2,
            relief="flat",
            command=lambda: self.toggle_borrow(book, popup)
        )
        action_btn.pack(pady=10)

    def toggle_borrow(self, book, popup):
        """ëŒ€ì¶œ/ë°˜ë‚© ìƒíƒœ ë³€ê²½"""
        if book["status"]:
            # ëŒ€ì¶œ ì²˜ë¦¬
            book["status"] = False
            messagebox.showinfo("ì„±ê³µ", f"'{book['title']}' ì±…ì„ ë¹Œë ¸ì–´ìš”! \në…ì„œ í†µì¥ì— ê¸°ë¡ë  ê±°ì˜ˆìš”.", parent=popup)
        else:
            # ë°˜ë‚© ì²˜ë¦¬
            book["status"] = True
            messagebox.showinfo("ì™„ë£Œ", f"'{book['title']}' ì±…ì„ ë°˜ë‚©í–ˆì–´ìš”! \nì¬ë¯¸ìˆê²Œ ì½ì—ˆë‚˜ìš”?", parent=popup)
        
        popup.destroy()
        self.refresh_book_list() # ëª©ë¡ ìƒˆë¡œê³ ì¹¨

if __name__ == "__main__":
    root = tk.Tk()
    app = KidsKioskApp(root)
    root.mainloop()
